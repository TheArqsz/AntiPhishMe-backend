language: python
cache: 
    directories:
        - $HOME/.cache/pip
python:
  - "3.8"

branches:
    only:
        - develop

install:
  - pip install -r requirements.txt
  - pip install codecov
script: pytest --cov=./antiphishme/src/ --alluredir ./antiphishme/tests/results --clean-alluredir --disable-pytest-warnings --cache-clear ./antiphishme/tests/

after_success:
    - codecov

after_script:
    - sh scripts/upload_allure_results.sh

notifications:
    slack:
        rooms:
            - secure: secret:oJkHRlXPFgrTfLCr+Kj/De5t3Q+fk21IZU7UrAKaMOestvIWdIaaMm5PvzmVtEZoqFxa1nrBS+hta82Ln5jsZEmiKrP/w8vtMiPZxThj+MvWpaBAnFW/H9NIQMAhmBYAfhTqAsvB41jIfJsyN4gLZr8F9vKt/UPbrnYr+soKV3g=
        on_success: always  # change: send a notification when the build status changes.
        on_failure: always  # always: always send a notification.
        template:
            - "Repository `%{repository_slug}` *%{result}* build (<%{build_url}|#%{build_number}>) for commit (<%{compare_url}|%{commit}>) branch `%{branch}`."
            - "Execution time: *%{duration}*"
            - "Message: %{message}"
    email: false